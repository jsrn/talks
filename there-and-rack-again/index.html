<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>There and Rack Again: What is Rack and Why</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h1>[draft] There and Rack Again</h1>
					<h2>What is Rack and Why</h2>
					<span>James Nutt</span>
					<br>
					<span>üê¶ @jsrndoftime üíå jsrn@hey.com üåê jsrn.net</span>
				</section>

				<section>
          <h1>Objectives</h1>

					<ol>
						<li>Understand how HTTP requests get to your app.</li>
						<li>Understand the role that rack plays.</li>
						<li>Make your own rack application.</li>
					</ol>
				</section>

				<section data-auto-animate>
					<h2 data-id="code-title">Requests and Responses</h2>

					<pre data-id="code-animation"><code class="http" data-trim data-line-numbers>
						GET / HTTP/1.1
						Host: www.example.com
					</code></pre>

					<pre data-id="code-animation"><code class="http" data-trim data-line-numbers>
						HTTP/1.1 200 OK
						Date: Mon, 23 May 2005 22:38:34 GMT
						Content-Type: text/html; charset=UTF-8
						Content-Length: 155
						Last-Modified: Wed, 08 Jan 2003 23:11:55 GMT
						Server: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)
						Accept-Ranges: bytes
						Connection: close

						&lt;html&gt;
						  &lt;head&gt;&lt;title&gt;An Example Page&lt;/title&gt;&lt;/head&gt;
						  &lt;body&gt;&lt;p&gt;Hello World!&lt;/p&gt;&lt;/body&gt;
						&lt;/html&gt;
					</code></pre>
				</section>

				<section>
					<h2>The Path</h2>

					<pre>
                 ___________________  ___________________________
_______________  |                 |  |                         |
|             |  |    webserver    |  |        app server       |
|  "the web"  |->|  (nginx, etc.)  |->|  (puma, unicorn, etc.)  |
|_____________|  |_________________|  |_________________________|
					</pre>
				</section>

				<section>
					<h2 data-id="code-title">The Littlest Server</h2>

					<pre data-id="code-animation"><code class="ruby" data-trim data-line-numbers>
						require 'socket'
						server = TCPServer.new 5678

						while session = server.accept
						  request = session.gets

						  session.print "HTTP/1.1 200\r\n"
						  session.print "Content-Type: text/html\r\n"
						  session.print "\r\n"
						  session.print "Hello world!"

						  session.close
						end
					</code></pre>
				</section>

				<section>
					<h2>Ruby Application Servers</h2>

					<span class="fragment">unicorn</span><!--
					--><span class="fragment">, puma</span><!--
					--><span class="fragment">, passenger</span><!--
					--><span class="fragment">, thin</span><!--
					--><span class="fragment">, falcon</span><!--
					--><span class="fragment">, prax</span><!--
					--><span class="fragment">, okay</span><!--
					--><span class="fragment">, OKAY.</span><!--
					--><span class="fragment"> That's enough.</span><!--
					--><span class="fragment"> Jeez.</span>
				</section>

				<section>
					<p>Your application server is going to want to pass requests to your application.</p>

					<p>Do they speak the same language?</p>
				</section>

				<section>
					<h2>Rack</h2>

					<blockquote cite="https://github.com/rack/rack">"a modular Ruby webserver interface"</blockquote>

					<p>Rack does the thinking, so you don't have to.</p>
				</section>

				<section>
					<h2>It's Everywhere</h2>

					<p>Your favourite Ruby (Rails, Hanami, Sinatra) applications are actually Rack applications.</p>
				</section>

				<section>
					<blockquote cite="https://github.com/rack/rack/blob/master/SPEC.rdoc">A Rack application is a Ruby object (not a class) that responds to call. It takes exactly one argument, the environment and returns an Array of exactly three values: The status, the headers, and the body.</blockquote>
				</section>

				<section>
					<h2>Environment Goes In</h2>

					<pre data-id="code-animation"><code class="ruby" data-trim>
						{
						  "REQUEST_METHOD" => "GET",
						  "QUERY_STRING" => "?page=10",
						  "SERVER_PORT" => 80,
						  # lots more!
						}
					</code></pre>
				</section>

				<section>
					<h2>Response Comes Out</h2>

					<pre data-id="code-animation"><code class="ruby" data-trim>
						[
						  200,
						  { 'Content-Type' => 'text/html' },
						  ["Hello, world!"]
						]
					</code></pre>
				</section>

				<section>
					<h2>Who Uses Rack?</h2>

					<table>
						<thead>
							<tr>
								<th>‚úÖ</th>
								<th>‚ùå</th>
							</tr>
						</thead>
						<tbody>
							<tr class="fragment">
								<td>unicorn</td><td></td>
							</tr>
							<tr class="fragment">
								<td>puma</td><td></td>
							</tr>
							<tr class="fragment">
								<td>passenger</td><td></td>
							</tr>
							<tr class="fragment">
								<td>thin</td><td></td>
							</tr>
							<tr class="fragment">
								<td>falcon</td><td></td>
							</tr>
							<tr class="fragment">
								<td>prax</td><td></td>
							</tr>
						</tbody>
					</table>
				</section>

				<section>
					<h2>The Littlest Rack Application</h2>

					<pre data-id="code-animation"><code class="ruby" data-trim>
            # app.rb
            class App
              def call(env)
                [
                  200,
                  { 'Content-Type' => 'text/html' },
                  ["Hello, world!"]
                ]
              end
            end
          </code></pre>

          <pre data-id="code-animation"><code class="ruby" data-trim>
            # config.ru
            require './app'
            run App.new
          </code></pre>
				</section>

				<section>
					<h2>rackup</h2>

					<blockquote>rackup is a useful tool for running Rack applications</blockquote>
				</section>

				<section>
					<h2>config.ru</h2>

					<p>This is the configuration file used by Rack-based servers. Here's the one from a new Rails 6.1 project.</p>

					<pre data-id="code-animation"><code class="ruby" data-trim>
            require_relative "config/environment"
            run Rails.application
            Rails.application.load_server
          </code></pre>
				</section>

				<section>
					<h2>Middleware</h2>

					<p>Add behaviour without changing your application.</p>

					<p>Essentially also a rack application.</p>

					<img src="img/dolls.jpg" alt="">
				</section>

				<section>
					<h2>What's Middleware Good For?</h2>

					<ul>
						<li>Logging</li>
						<li>Setting headers</li>
						<li>Adding compression</li>
					</ul>
				</section>

				<section>
					<h2>Let's Make Rails</h2>

					<ul>
						<li>78,913 commits</li>
						<li>huge contributor community</li>
						<li>corporate backing</li>
					</ul>
				</section>

				<section>
					<h2>Let's not.</h2>
				</section>

				<section>
					<h2>Let's replicate a small subset of Rails-like features</h2>
				</section>

				<section>
					<h2>To Do</h2>

					<ol>
						<li>Routing</li>
						<li>Controllers</li>
						<li>Views</li>
					</ol>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
